<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Motorcycle Route Planner</title>

<!-- Leaflet & Routing CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"/>

<style>
html,body{
  margin:0;padding:0;height:100%;
  font-family:"Poppins",sans-serif;
  background:url("sj.jpeg") no-repeat center center/contain;
  background-color:black;
  background-attachment:fixed;
  transition:filter 1s ease;
}
body.dark-mode{filter:brightness(0.45);}

#home-screen,#nav-screen{
  width:100%;height:100%;
  display:flex;flex-direction:column;
  align-items:center;justify-content:flex-start;
  position:relative;z-index:1;
}
#nav-screen{display:none;background:rgba(0,0,0,0.9);animation:fadeIn .7s ease;}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

#panel{
  background:rgba(0,0,0,0.65);color:white;
  padding:15px;border-radius:15px;width:90%;max-width:420px;
  text-align:center;margin-top:20px;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);backdrop-filter:blur(6px);
}
input{width:85%;padding:6px;margin:4px 0;border:none;border-radius:6px;}
button{
  background:linear-gradient(135deg,#ff5f6d,#ffc371);
  border:none;color:white;font-weight:bold;
  padding:7px 14px;border-radius:6px;margin:3px;
  cursor:pointer;transition:transform .2s,box-shadow .2s;
}
button:hover{transform:scale(1.05);box-shadow:0 2px 8px rgba(0,0,0,.3);}
button:disabled{background:gray;opacity:.6;cursor:not-allowed;}

#small-map{width:90%;max-width:420px;height:260px;margin-top:15px;
  border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.4);}
#full-map{width:100%;height:100%;z-index:10;}
#backBtn{
  position:absolute;top:15px;left:15px;z-index:20;
  background:rgba(0,0,0,.7);color:white;border:none;
  padding:8px 12px;border-radius:8px;font-weight:bold;cursor:pointer;
}
#status{margin-top:5px;font-size:.85rem;}
</style>
</head>
<body>

<!-- üè† Dashboard -->
<div id="home-screen">
  <div id="panel">
    <b style="font-size:1.2rem;">üõµ Motorcycle Route Planner</b><br/>
    <input type="text" id="originInput" placeholder="Enter Origin"/>
    <div>
      <button id="originBtn">Set Origin</button>
      <button id="locOriginBtn">üìç My Location</button>
    </div>
    <input type="text" id="destInput" placeholder="Enter Destination"/>
    <button id="destBtn">Set Destination</button><br/>
    <button id="clearBtn">Clear</button>
    <button id="routeBtn">Shortest Route</button>
    <button id="navBtn" disabled>üèçÔ∏è Let's Ride..!</button>
    <div id="status"></div>
  </div>
  <div id="small-map"></div>
</div>

<!-- üó∫Ô∏è Full Map -->
<div id="nav-screen">
  <button id="backBtn">‚¨ÖÔ∏è Back</button>
  <div id="full-map"></div>
</div>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
<script src="https://unpkg.com/leaflet-polylinedecorator"></script>

<script>
window.onload = () => {
  // Maps
  const smallMap = L.map("small-map").setView([18.5204,73.8567],10);
  const fullMap  = L.map("full-map").setView([18.5204,73.8567],10);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(smallMap);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(fullMap);

  // Vars
  let points=[],markers=[],routeControl=null;
  const body=document.body;
  const homeScreen=document.getElementById("home-screen");
  const navScreen=document.getElementById("nav-screen");
  const navBtn=document.getElementById("navBtn");
  const backBtn=document.getElementById("backBtn");
  const status=document.getElementById("status");

  function setStatus(msg,err=false){status.style.color=err?"tomato":"white";status.textContent=msg;}
  function updateNavButtonState(){navBtn.disabled=!(points[0]&&points[1]);}

  async function geocode(addr){
    const url=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`;
    const r=await fetch(url);const d=await r.json();
    if(!d.length)throw new Error("Address not found");
    return[parseFloat(d[0].lat),parseFloat(d[0].lon)];
  }

  function addMarker(map,lat,lon,label,color){
    const icon=L.divIcon({html:`<div style="background:${color};width:12px;height:12px;border-radius:50%;border:2px solid white;"></div>`});
    const m=L.marker([lat,lon],{icon}).bindPopup(label).addTo(map);
    markers.push({map,m});
  }

  // üìç My Location
  document.getElementById("locOriginBtn").onclick=()=>{
    if(!navigator.geolocation)return setStatus("‚ùå Geolocation not supported",true);
    setStatus("Getting location...");
    navigator.geolocation.getCurrentPosition(pos=>{
      const{latitude,longitude}=pos.coords;
      document.getElementById("originInput").value="My Current Location";
      points[0]=[latitude,longitude];
      addMarker(smallMap,latitude,longitude,"Origin","green");
      addMarker(fullMap,latitude,longitude,"Origin","green");
      smallMap.setView([latitude,longitude],13);fullMap.setView([latitude,longitude],13);
      setStatus("‚úÖ Origin set from location");updateNavButtonState();
    },()=>setStatus("‚ö†Ô∏è Location access denied",true));
  };

  // Manual origin
  document.getElementById("originBtn").onclick=async()=>{
    try{
      const addr=document.getElementById("originInput").value.trim();if(!addr)return;
      const[lat,lon]=await geocode(addr);
      points[0]=[lat,lon];
      addMarker(smallMap,lat,lon,"Origin","green");
      addMarker(fullMap,lat,lon,"Origin","green");
      smallMap.setView([lat,lon],12);
      updateNavButtonState();setStatus("‚úÖ Origin set");
    }catch(e){setStatus(e.message,true);}
  };

  // Destination
  document.getElementById("destBtn").onclick=async()=>{
    try{
      const addr=document.getElementById("destInput").value.trim();if(!addr)return;
      const[lat,lon]=await geocode(addr);
      points[1]=[lat,lon];
      addMarker(smallMap,lat,lon,"Destination","red");
      addMarker(fullMap,lat,lon,"Destination","red");
      smallMap.setView([lat,lon],12);
      updateNavButtonState();setStatus("‚úÖ Destination set");
    }catch(e){setStatus(e.message,true);}
  };

  // Shortest Route (with arrows + directions)
  document.getElementById("routeBtn").onclick=()=>{
    if(points.length<2)return setStatus("Set both points",true);
    if(routeControl){fullMap.removeControl(routeControl);}
    routeControl=L.Routing.control({
      waypoints:[
        L.latLng(points[0][0],points[0][1]),
        L.latLng(points[1][0],points[1][1])
      ],
      routeWhileDragging:false,
      showAlternatives:false,
      lineOptions:{styles:[{color:"orange",weight:5}]},
      createMarker:()=>null
    }).addTo(fullMap);

    // Add arrows visually
    routeControl.on("routesfound",e=>{
      const coords=e.routes[0].coordinates;
      const line=L.polyline(coords,{color:"orange"}).addTo(smallMap);
      const decorator=L.polylineDecorator(line,{
        patterns:[{offset:25,repeat:50,symbol:L.Symbol.arrowHead({pixelSize:8,pathOptions:{color:"orange"}})}]
      }).addTo(smallMap);
      setStatus(`‚úÖ Route ready (${(e.routes[0].summary.totalDistance/1000).toFixed(1)} km)`);
    });
    updateNavButtonState();
  };

  // Clear button
  document.getElementById("clearBtn").onclick=()=>{
    points=[];markers.forEach(({map,m})=>map.removeLayer(m));markers=[];
    if(routeControl){fullMap.removeControl(routeControl);routeControl=null;}
    document.getElementById("originInput").value="";
    document.getElementById("destInput").value="";
    navBtn.disabled=true;
    setStatus("üßπ Cleared");
    smallMap.eachLayer(l=>{if(l instanceof L.Polyline)smallMap.removeLayer(l);});
  };

  // Screen transitions
  navBtn.onclick=()=>{
    if(navBtn.disabled)return;
    homeScreen.style.display="none";navScreen.style.display="flex";
    body.classList.add("dark-mode");setTimeout(()=>fullMap.invalidateSize(),300);
  };
  backBtn.onclick=()=>{
    navScreen.style.display="none";homeScreen.style.display="flex";
    body.classList.remove("dark-mode");
  };
};
</script>
</body>
</html>
